import axios from 'axios'
import { Skolengo } from '../src/index'
import { SkolengoResponse } from '../src/models/Globals'
import { School } from '../src/models/School/School'

const testData: SkolengoResponse<School[]> = { data: [{ id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Collège', addressLine1: '5 rue du Lycée', addressLine2: null, addressLine3: null, zipCode: '67142', city: 'BARR CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Fclg-barr.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Collège André Maurois', addressLine1: '1 rue du Lycée', addressLine2: null, addressLine3: null, zipCode: '67242', city: 'BISCHWILLER CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Fcite-maurois.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Collège Christiane Perceret', addressLine1: '8 rue du Lycée', addressLine2: null, addressLine3: null, zipCode: '21140', city: 'SEMUR EN AUXOIS', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Fclg-cperceret-semur-en-auxois.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Etablissement régional d'enseignement adapté Cité Scolaire René Pellet - Lycée des métiers du tertiaire et de l'artisanat d'art", addressLine1: '32 rue DE FRANCE', addressLine2: null, addressLine3: null, zipCode: '69602', city: 'VILLEURBANNE CEDEX', country: 'France', homePageUrl: 'https://cas.ent.auvergnerhonealpes.fr/login?service=https%3A%2F%2Ferea-pellet.ent.auvergnerhonealpes.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'rra', emsOIDCWellKnownUrl: 'https://sso.ent.auvergnerhonealpes.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "LPO Louis Aragon - Lycée des métiers de l'énergie et du développement durable", addressLine1: 'Rue Pierre Mendès France', addressLine2: null, addressLine3: null, zipCode: '70400', city: 'HERICOURT', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flyc-laragon-hericourt.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "LPO Victor Bérard - Lycée des métiers de l'optique et des microtechniques", addressLine1: '35 quai Aimé Lamy', addressLine2: null, addressLine3: null, zipCode: '39403', city: 'MOREZ CEDEX', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flyc-vberard-morez.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Lycée  professionnel  Gustave Eiffel - Lycées des métiers du bâtiment et des travaux publics', addressLine1: 'Rue Gustave Eiffel', addressLine2: null, addressLine3: null, zipCode: '68701', city: 'CERNAY CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-eiffel-cernay.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée André Citroen - Lycée des métiers de l'automobile", addressLine1: "5  RUE DU 11EME REGIMENT D'AVIATION", addressLine2: null, addressLine3: null, zipCode: '57155', city: 'MARLY', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-citroen.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Lycée André Malraux - Lycée des métiers filière bois', addressLine1: "13 rue DE L'EPINETTE", addressLine2: null, addressLine3: null, zipCode: '88204', city: 'REMIREMONT CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-malraux.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Lycée Atlas', addressLine1: '8 rue Kervégan', addressLine2: '', addressLine3: '', zipCode: '44240', city: 'Nantes', country: 'France', homePageUrl: 'https://cas1.kosmoseducation.com/login?service=https%3A%2F%2Fatlas.kosmoseducation.com%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'metab', emsOIDCWellKnownUrl: 'https://sso1.skolengo.com/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Lycée Charles Jully - Lycée des métiers et des technologies innovantes', addressLine1: '59 rue MARECHAL FOCH', addressLine2: null, addressLine3: null, zipCode: '57501', city: 'ST AVOLD CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-jully.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée Condorcet - Lycée des métiers des sciences et des technologies de l' information et de la communication", addressLine1: "Rue DE L'ETANG", addressLine2: null, addressLine3: null, zipCode: '57350', city: 'SCHOENECK', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-condorcet.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "LYCEE D'ENSEIGNEMENT ADAPTE", addressLine1: 'Rue DE LA MADELEINE', addressLine2: null, addressLine3: null, zipCode: '52130', city: 'WASSY', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Ferea-pre-aux-saules.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général et technologique agricole de la Barotte-Haute-Côte-d'Or", addressLine1: 'Route de langres', addressLine2: null, addressLine3: null, zipCode: '21403', city: 'CHATILLON SUR SEINE CEDEX', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegta-la-barotte.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général et technologique agricole de la Roche-sur-Foron", addressLine1: '212 rue anatole france', addressLine2: null, addressLine3: null, zipCode: '74805', city: 'LA ROCHE SUR FORON CEDEX', country: 'France', homePageUrl: 'https://cas.ent.auvergnerhonealpes.fr/login?service=https%3A%2F%2Fenilv.ent.auvergnerhonealpes.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'rra', emsOIDCWellKnownUrl: 'https://sso.ent.auvergnerhonealpes.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général et technologique agricole de Lons Le Saunier - Montmorot", addressLine1: '614 avenue edgar faure', addressLine2: null, addressLine3: null, zipCode: '39570', city: 'MONTMOROT', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegta-montmorot.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général et technologique agricole de Mâcon-Davayé", addressLine1: '43 rue les poncetys', addressLine2: null, addressLine3: null, zipCode: '71960', city: 'DAVAYE', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegta-macon-davaye.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général et technologique agricole de Plombieres-les-Dijon", addressLine1: '85 rue de velars', addressLine2: null, addressLine3: null, zipCode: '21370', city: 'PLOMBIERES LES DIJON', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegta-plombieres-les-dijon.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général privé Institution Notre Dame", addressLine1: '6 rue des Bonnes gens', addressLine2: null, addressLine3: null, zipCode: '67082', city: 'STRASBOURG CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Finst-notredame67.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général,", addressLine1: '79 avenue de jasseron', addressLine2: null, addressLine3: null, zipCode: '01000', city: 'BOURG EN BRESSE', country: 'France', homePageUrl: 'https://cas.ent.auvergnerhonealpes.fr/login?service=https%3A%2F%2Fsardieres.ent.auvergnerhonealpes.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'rra', emsOIDCWellKnownUrl: 'https://sso.ent.auvergnerhonealpes.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général, technologique et professionnel agricole de Dannemarie - Besancon", addressLine1: '2 rue des chanets', addressLine2: null, addressLine3: null, zipCode: '25410', city: 'DANNEMARIE SUR CRETE', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegtpa-besancon.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général, technologique et professionnel agricole de Quétigny", addressLine1: '21 boulevard olivier de serres', addressLine2: null, addressLine3: null, zipCode: '21800', city: 'QUETIGNY', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegtpa-quetigny.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: "Lycée d'enseignement général, technologique et professionnel agricole de Vesoul", addressLine1: '16 rue edouard belin', addressLine2: null, addressLine3: null, zipCode: '70014', city: 'VESOUL CEDEX', country: 'France', homePageUrl: 'https://cas.eclat-bfc.fr/login?service=https%3A%2F%2Flegtpa-vesoul.eclat-bfc.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'bfc', emsOIDCWellKnownUrl: 'https://sso.eclat-bfc.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Lycée des métiers Pierre Mendès France', addressLine1: '100 rue DU SHAH DE PERSE', addressLine2: null, addressLine3: null, zipCode: '88140', city: 'CONTREXEVILLE', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-mendes-france-contrexeville.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }, { id: 'SKO-E-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx', type: 'school', attributes: { name: 'Lycée des métiers régional du Toulois', addressLine1: '16 quai DE LA GLACIERE', addressLine2: null, addressLine3: null, zipCode: '54201', city: 'TOUL CEDEX', country: 'France', homePageUrl: 'https://cas.monbureaunumerique.fr/login?service=https%3A%2F%2Flyc-toulois.monbureaunumerique.fr%2Fsg.do%3FPROC%3DPAGE_ACCUEIL', emsCode: 'gdest', emsOIDCWellKnownUrl: 'https://sso.monbureaunumerique.fr/oidc/.well-known' } }], links: { first: 'http://bff-prod-ha/api/v1/bff-sko-app/schools?page[limit]=25&filter[text]=Lyc%C3%A9e&fields=addressLine1%2CaddressLine2%2CaddressLine3%2Ccity%2Ccountry%2CemsCode%2CemsOIDCWellKnownUrl%2ChomePageUrl%2Cname%2CzipCode%2Cdistance', last: 'http://bff-prod-ha/api/v1/bff-sko-app/schools?page[limit]=25&page[offset]=325&filter[text]=Lyc%C3%A9e&fields=addressLine1%2CaddressLine2%2CaddressLine3%2Ccity%2Ccountry%2CemsCode%2CemsOIDCWellKnownUrl%2ChomePageUrl%2Cname%2CzipCode%2Cdistance', next: 'http://bff-prod-ha/api/v1/bff-sko-app/schools?page[limit]=25&page[offset]=25&filter[text]=Lyc%C3%A9e&fields=addressLine1%2CaddressLine2%2CaddressLine3%2Ccity%2Ccountry%2CemsCode%2CemsOIDCWellKnownUrl%2ChomePageUrl%2Cname%2CzipCode%2Cdistance' }, meta: { totalResourceCount: 326 } }

jest.mock('axios')
const mockedAxios = axios as jest.Mocked<typeof axios> & jest.Mock<typeof axios>
mockedAxios.request.mockResolvedValue({
  data: testData
})

describe('Test searchSchool', () => {
  beforeEach(() => mockedAxios.mockClear())
  it('should call the right url and return schools', async () => {
    await Skolengo.searchSchool('Lycée', 25, 0)
    expect(mockedAxios.request).toBeCalledWith({
      baseURL: 'https://api.skolengo.com/api/v1/bff-sko-app',
      method: 'get',
      responseType: 'json',
      url: '/schools',
      params: {
        page: { limit: 25, offset: 0 },
        filter: { text: 'Lycée' }
      }
    })
  })
})
